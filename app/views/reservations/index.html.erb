
<section class="bg-primary py-5 text-center">
    <h1 class="text-light">Réservations</h1>
</section>
<br>

<section class="container align-items-center justify-content-center">
<% @reservations.each do |reservation| %>
    <div class="card mb-2 border border-2" style="max-width: 100%">
        <div class="row g-0">
            <div class="col-md-4">
                <%if reservation.workout.image1.attached?%>
                    <%= image_tag reservation.workout.image1, alt: "workout-image", class: "img-fluid" %>
                <%else%>
                    <%= image_tag 'logokeella.png', alt: "workout-image", class: "img-fluid" %>
                <%end%>
            </div>
                <div class="col-md-8">
                <div class="card-body">
                        <p>N° de réservation : <%= reservation.id %></p>
                    <% if reservation.workout%>
                        <h5 class="card-title"><%= reservation.workout.title %></h5>
                        <p class="card-text">Utilisateur : <%= reservation.workout.host.email %></p>
                        <p class="card-text">Date du début de l'entraînement : <%= reservation.workout.start_date.strftime("%d/%m/%Y %H:%M") %></p>
                        <p class="card-text">Date de fin de l'entraînement : <%= reservation.workout.end_date.strftime("%d/%m/%Y %H:%M") %></p>
                    <% else %>
                        <p>L'annonce a été supprimé par son créateur.</p>
                    <% end%>
                        <p class="card-text">Status : <%= reservation.status %></p>
                        <p class="card-text"><small class="text-body-secondary">Date de la réservation <%= reservation.created_at.strftime("%d/%m/%Y %H:%M") %></small></p>
                    

                    <div class="row">
                        <div class="btn-group">
                            <% if reservation.status == 'accepted' %>
                            <%= button_to 'Confirmer fin de séance', reservation_path(reservation, user_decision: "closed"), method: :patch, class: 'btn btn-primary' %>
                                <%= button_to 'Annuler', reservation_path(reservation, user_decision: "user_cancelled"), method: :patch, class: 'btn btn-danger' %>
                            <% elsif reservation.status == 'pending' %>
                                <%= button_to 'Relancer la demande', reservation_path(reservation, user_decision: "relaunched"), method: :patch, class: 'btn btn-secondary disabled' %>                            
                            <% elsif reservation.status == 'closed' %>
                                
                        
                            
                        <% if reservation.host_rating.nil? %>
                            <%= form_with(model: reservation, url: reservation_path(reservation), method: :patch) do |form| %>
                              <div class="dropdown">
                                <a class="btn btn-primary dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                  Choisis ta note
                                </a>
                                <ul class="dropdown-menu">
                                  <% (1..5).each do |rating| %>
                                    <li>
                                      <%= form.radio_button :host_rating, rating %>
                                      <%= form.label "host_rating_#{rating}" do %>
                                      <%= raw("<i class='bi bi-star-fill'></i>" * rating) %>
                                        <% end %>
                                      
                                    </li>
                                  <% end %>
                                  <%= form.submit 'Envoyer' %>
                                </ul>
                              </div>
                            <% end %>
                          <% else %>
                            <p>Vous avez déjà soumis une note pour cette réservation.</p>
                        <% end %>
                          
                        <% if reservation.host_comment.nil? %>
                            <%= form_with(model: reservation, url: reservation_path(reservation), method: :patch) do |form| %>
                              <div class="dropdown">
                                <a class="btn btn-primary dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                  Laisse un commentaire
                                </a>
                                <ul class="dropdown-menu">
                                  <%= form.label :host_comment, 'Commentaire pour l\'hôte' %>
                                  <%= form.text_area :host_comment %>
                                  <%= form.submit 'Envoyer' %>
                                </ul>
                              </div>
                            <% end %>
                          <% else %>
                            <p>Vous avez déjà soumis un commentaire pour cette réservation.</p>
                        <% end %>
                          
                                    
                                    
                                    
                                    
                                
                                
                            <% end %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
  <% end %>
</section>
  
  